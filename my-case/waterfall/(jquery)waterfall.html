<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-touch-fullscreen" content="yes">
	<meta name="format-detection" content="telephone=no">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="robots" content="NOINDEX,NOFOLLOW,NOARCHIVE">
	<title>瀑布流</title>
	<style type="text/css">
		*{margin: 0;padding: 0;}
		img{outline: none;}
        #main{position: relative;} 
        #boxWrap{margin-left: -7px;position: relative;}
        .box {padding:15px 0 0 15px;float: left;}
        .pic{border: 1px solid #ccc;padding: 10px;border-radius: 5px;box-shadow: 0 0 5px #CCC;}
        .pic img{display: block;width: 165px;height: auto;}
        @media screen and (max-width: 330px) and (min-width: 320px){
        	.pic img{width: 115px;}
        }
        @media screen and (max-width: 340px) and (min-width: 331px){
        	.pic img{width: 120px;}
        }
        @media screen and (max-width: 360px) and (min-width: 341px){
        	.pic img{width: 125px;}
        }
        @media screen and (max-width: 380px) and (min-width: 361px){
        	.pic img{width: 130px;}
        }
        @media screen and (max-width: 400px) and (min-width: 381px){
        	.pic img{width: 135px;}
        }
        @media screen and (max-width: 420px) and (min-width: 401px){
        	.pic img{width: 140px;}
        }
        @media screen and (max-width: 440px) and (min-width: 421px){
        	.pic img{width: 145px;}
        }
        @media screen and (max-width: 460px) and (min-width: 441px){
        	.pic img{width: 150px;}
        }
        @media screen and (max-width: 480px) and (min-width: 461px){
        	.pic img{width: 155px;}
        }
        @media screen and (max-width: 500px) and (min-width: 481px){
        	.pic img{width: 160px;}
        }
        
        
	</style>
</head>
<body>
	<div id="main" class="main">
		<div id="boxWrap">
			<div class="box">
				<div class="pic"><img src="../image/f2.jpg" alt="瀑布流"></div>
			</div>
			<div class="box">
				<div class="pic"><img src="../image/f13.jpg" alt="瀑布流"></div>
			</div>
			<div class="box">
				<div class="pic"><img src="../image/f3.jpg" alt="瀑布流"></div>
			</div>
			<div class="box">
				<div class="pic"><img src="../image/f4.jpg" alt="瀑布流"></div>
			</div>
			<div class="box">
				<div class="pic"><img src="../image/f5.jpg" alt="瀑布流"></div>
			</div>
			<div class="box">
				<div class="pic"><img src="../image/f6.jpg" alt="瀑布流"></div>
			</div>
			<div class="box">
				<div class="pic"><img src="../image/f7.jpg" alt="瀑布流"></div>
			</div>
			<div class="box">
				<div class="pic"><img src="../image/f8.jpg" alt="瀑布流"></div>
			</div>
			<div class="box">
				<div class="pic"><img src="../image/f9.jpg" alt="瀑布流"></div>
			</div>
			<div class="box">
				<div class="pic"><img src="../image/f10.jpg" alt="瀑布流"></div>
			</div>
			<div class="box">
				<div class="pic"><img src="../image/f11.jpg" alt="瀑布流"></div>
			</div>
			<div class="box">
				<div class="pic"><img src="../image/f12.jpg" alt="瀑布流"></div>
			</div>
			<div class="box">
				<div class="pic"><img src="../image/f13.jpg" alt="瀑布流"></div>
			</div>
			<div class="box">
				<div class="pic"><img src="../image/f14.jpg" alt="瀑布流"></div>
			</div>
			<div class="box">
				<div class="pic"><img src="../image/f1.jpg" alt="瀑布流"></div>
			</div>
		</div>
	</div>
    <script type="text/javascript" src="jQuery2.1.1.js"></script>
	<script type="text/javascript">
	    $(window).on('load resize refresh',function () {
	    	waterfall();
	    	var dataInt={"data":[
	    		{"src":"../image/f10.jpg"},
	    		{"src":"../image/f11.jpg"},
	    		{"src":"../image/f12.jpg"},
	    		{"src":"../image/f13.jpg"},
	    	]};

	    	$(window).scroll(function () {
	    		if (checkScrollSlide) {
	    			$.each(dataInt.data,function (key,value) {
	    				var boxhtml='<div class="box"><div class="pic"><img src="'+value.src+'" /></div></div>';
	    				$('#main>div').append(boxhtml);
	    			})
	    			waterfall();
	    		}
	    	});
	    });
	
        function waterfall(){
        	var $parent=$('#main')
         	var $boxs=$('#main .box');
         	var w=$boxs.eq(0).outerWidth();
            var cols=Math.floor($(window).width()/w);
            $parent.css({'margin':'0 auto','width':w*cols+'px'});
            var hArr=[];
            $boxs.each(function (index,value) {
            	
            	var h=$boxs.eq(index).outerHeight();
            	if (index<cols ) {
                   hArr.push(h);
                   var maxH=Math.max.apply(null,hArr);
                   $parent.height(maxH);
            	} else {
                   var minH=Math.min.apply(null,hArr);
                   var minHIndex=$.inArray(minH,hArr);
                   $(value).css({'position':'absolute','left':minHIndex*w+'px','top':minH+'px'}); 

                   hArr[minHIndex]+=$boxs.eq(index).outerHeight();
                   
   				   var maxH=Math.max(hArr[minHIndex]);
               	   $parent.height(maxH);
            	}
            });

           
        } 


		/*检测是否具备了滚动条加载数据块的条件*/
		function checkScrollSlide() {
			var lastlBox=$('#main .box').last();
			
			var lastBoxDis=lastlBox.offset().top+Math.floor(lastlBox.outerHeight()/2);
			var scrollTop=$(window).scrollTop();
			var height=$(window).height();
			return (lastBoxDis<(scrollTop+height))?true:false;
		}


	</script>
</body>
</html>