<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="robots" content="NOINDEX,NOFOLLOW,NOARCHIVE">
    <title>详情</title>
    <link href="./bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="./main.css">
</head>
<body>
    <div class="comwid">
        <div class="tip list-tip">加载中...</div>
        <div class="panel panel-default detail-box hide">
            <div class="panel-heading"></div>
            <div class="panel-body">
                <div class="img-box"></div>
            </div>
            <div class="panel-body">
                <div class="media">
                  <div><span class="dtit">豆瓣评分</span></div>
                  <div class="media-left">
                    <span class="score"></span>
                  </div>
                  <div class="media-body">
                    <div class="star-box"></div>
                    <div><a href="javascript:;"><span class="ratings-count"></span>人评价</a></div>
                  </div>
                </div>
                <div><span class="dtit">又名：</span><span class="akas"></span></div>
                <div><span class="dtit">原名：</span><span class="oritit"></span></div>
                <div><span class="dtit">导演：</span><a href="javascript:;" class="author"></a></div>
                <div><span class="dtit">主演：</span><span class="casts"></span></div>
                <div><span class="dtit">制片国家/地区：</span><span class="country"></span></div>
                <div><span class="dtit">类型：</span><span class="genres"></span></div>
                <div><div><span class="dtit">剧情简介：</span></div><div class="summary"></div></div>
            </div>
        </div>

        <div class="text-center empty-box">
            <div><img src="empty.png" alt="empty"></div>
            <div>加载失败</div>
        </div>
    </div>
    <script src="./jquery.min.js"></script>
    <script src="./bootstrap.min.js"></script>	
    <script src="./utils.js"></script>

    <script type="text/javascript">
        
        $(function () {
            var movieId=getUrlParam('id');
            var url='';

            if (movieId!=undefined) {
                url=gobalurl+'/v2/movie/subject/'+movieId;
                httpGet(url,callback,error);
                $('.tip').text('加载中...')
            }else{
                $('.tip').text('暂无数据')
            }

            function error() {
                $('.tip').hide();
                $('.detail-box').addClass('hide');
                $('.empty-box').show();
            }
            
            function callback(res) {

                //console.log(res.code);
                if(res){
                    $('.tip').hide();
                    $('.detail-box').removeClass('hide');
                    console.log(res);
                    var title=res.title;
                    var average=res.rating.average;
                    var img_url=res.images.small;
                    var aka=res.aka;
                    var original_title=res.original_title;
                    var author=res.directors[0].name;
                    var year=res.year;
                    var countries=res.countries;
                    var genres=res.genres;
                    var casts=res.casts;
                    var summary=res.summary;
                    var id=res.id;
                    var star=starToArr(res.rating.stars);
                    // console.log(star);
                    summary=summary.replace(/\n/g,'<br/>');

                    $('.img-box').append('<img src="'+img_url+'" alt="'+title+'" class="detail-img">');
                    $('.panel-heading').html(title+'('+year+')')
                    $('.score').html(average);
                    $('.star-box').append('<div class="star" id="star'+id+'"></div>');
                    $('.ratings-count').html(res.ratings_count);
                    $('.country').html(countries);
                    $('.author').html(author);
                    $('.oritit').html(original_title);
                    $('.summary').html(summary);

                    
                    $.each(casts,function (idx,val) {
                        $('.casts').append('<a href="javascript:;">'+val.name+'</a><span class="line">/</span>');
                        $('.casts .line').eq(casts.length-1).remove();
                    })
                    $.each(genres,function (idx,val) {
                        $('.genres').append('<span>'+val+'</span><span class="line">/</span>');
                        $('.genres .line').eq(genres.length-1).remove();
                    })
                    $.each(aka,function (idx,val) {
                        $('.akas').append('<span>'+val+'</span><span class="line">/</span>');
                        $('.akas .line').eq(aka.length-1).remove();
                    });
                    if(aka.length==0){
                        $('.akas').parent().hide();
                    }

                    appendStar(star,$('#star'+id));
                }
            }


            // $.ajax({
            //     url:'https://api.douban.com/v2/movie/top250',
            //     type:'GET',
            //     dataType: 'jsonp',
            //     crossDomain: true,
            //     success:function (res) {
            //         if(res){
            //             $('.tip').hide();
            //             $.each(res.subjects,function (idx,val) {
            //                if (movieId==val.id) {
            //                    var $content='<div class="panel-heading">'+val.title+'</div>'+
            //                    '<div class="panel-body"><img src="'+val.images.small+'" alt="'+val.title+'" class="detail-img"></div>'+
            //                    '<div class="panel-body">'+
            //                        '<div>原名：'+val.original_title+'</div>'+
            //                        '<div>导演：'+val.directors[0].name+'</div>'+
            //                        '<div>标签：'+val.genres+'</div>'+
            //                        '<div>主演：<span class="casts-box"></span></div>'+
            //                    '</div>';
            //                    $('.detail-box').append($content);
            //                    $.each(val.casts,function (castsid,castsval) {
            //                        var $casts='<span>'+castsval.name+'</span>';
            //                        $('.casts-box').append($casts)
            //                    })
            //                }
            //             })  
            //         }                       
            //     },
            //     error:function (res) {
            //         alert(res)
            //     },
            // })
            

        })
    </script>
</body>
</html>